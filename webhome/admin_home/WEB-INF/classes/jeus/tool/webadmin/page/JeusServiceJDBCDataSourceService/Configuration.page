<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE page-specification PUBLIC "-//Apache Software Foundation//Tapestry Specification 4.0//EN" "http://jakarta.apache.org/tapestry/dtd/Tapestry_4_0.dtd">
<page-specification class="jeus.tool.webadmin.page.JeusServiceJDBCDataSourceService.ConfigurationPage">
    <component id="mainBorder" type="jeus:MainBorder">
        <binding name="title" value="literal:JDBC Data Source Service Configuration"/>        
    </component>

    <component id="tabPanel" type="jeus:TabPanel">
        <binding name="pageNames" value="new java.lang.String[]{pageName}"/>
        <binding name="subtabNames" value="database.dataSourceType.equals(@jeus.xml.binding.jeusDD.DataSourceTypeType@DATA_SOURCE) ? {'properties'} : {'properties', 'pool'}"/>
    </component>

    <component id="properties" type="Block"/>
    <component id="pool" type="Block"/>

    <component id="propertiesForm" type="jeus:JEUSForm">
        <binding name="title" value="message:dsc.properties.title2"/>
        <binding name="useDefaultButtons" value="true"/>
        <binding name="success" value="listener:onPropertiesOk"/>
    </component>
    
    <component id="export_name" type="jeus:Field">
        <binding name="field" value="component:export_nameField"/>
    </component>

    <component id="export_nameField" type="jeus:JAXBInsert">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:exportName"/>
    </component>

	<component id="vendor" type="jeus:Field">
        <binding name="field" value="component:vendorField"/>
    </component>

    <component id="vendorField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:vendor"/>
        <binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@getEnumPropertySelectionModel(@jeus.xml.binding.jeusDD.VendorType@class)"/>
    </component>    

    <component id="data_source_class_name" type="jeus:Field">
        <binding name="field" value="component:data_source_class_nameField"/>
    </component>

    <component id="data_source_class_nameField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:dataSourceClassName"/>
        <binding name="validators" value="validators:required"/>
    </component>

    <component id="data_source_type" type="jeus:Field">
        <binding name="field" value="component:data_source_typeField"/>
    </component>

    <component id="data_source_typeField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:dataSourceType"/>
        <binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@getEnumPropertySelectionModel(@jeus.xml.binding.jeusDD.DataSourceTypeType@class)"/>
    </component>

    <component id="database_name" type="jeus:Field">
        <binding name="field" value="component:database_nameField"/>
    </component>

    <component id="database_nameField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:databaseName"/>
    </component>

    <component id="port_number" type="jeus:Field">
        <binding name="field" value="component:port_numberField"/>
    </component>

    <component id="port_numberField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:portNumber"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>
    </component>

    <component id="server_name" type="jeus:Field">
        <binding name="field" value="component:server_nameField"/>
    </component>

    <component id="server_nameField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:serverName"/>
    </component>

    <component id="user" type="jeus:Field">
        <binding name="field" value="component:userField"/>
    </component>

    <component id="userField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:user"/>
    </component>

    <component id="password" type="jeus:Field">
        <binding name="field" value="component:passwordField"/>
    </component>

    <component id="algorithmField" type="PropertySelection">
        <binding name="value" value="passwordAlgorithm"/>
        <binding name="model" value="jdbcAlgorithmModel"/>
        <!--<binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@JEUS_CIPHER_ALGORITHM"/>-->
        <binding name="disabled" value="!@jeus.tool.webadmin.hivemind.Lock@isEnabledEdit(getSettings(), getVisit())"/>
    </component>

    <component id="passwordField" type="jeus:JAXBAlgorithmField">
        <binding name="hidden" value="true"/>
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:password"/>
        <binding name="algorithm" value="passwordAlgorithm"/>
    </component>

	<component id="autoCommit" type="jeus:Field">
		<binding name="field" value="component:autoCommitField"/>
	</component>
	
	<component id="autoCommitField" type="PropertySelection">
		<binding name="parentElement" value="database"/>
		<binding name="elementName" value="literal:autoCommit"/>
		<binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@getPropertySelectionModel({'','false','true'})"/>
		<binding name="value" value="autoCommit"/>
		<binding name="disabled" value="!@jeus.tool.webadmin.hivemind.Lock@isEnabledEdit(getSettings(), getVisit())"/>
	</component>
    
    <component id="stmtQueryTimeout" type="jeus:Field">
        <binding name="field" value="component:stmtQueryTimeoutField"/>
        <binding name="unit" value="message:common.unit.msec"/>
    </component>

    <component id="stmtQueryTimeoutField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:stmtQueryTimeout"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>
    </component>

    <component id="additional_properties" type="jeus:Field">
        <binding name="field" value="component:additional_propertiesField"/>
    </component>

    <component id="additional_propertiesField" type="jeus:JAXBTextArea">
		<binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:property"/>
        <binding name="translator" value="bean:typePropertyTranslator"/>
    </component>
	
	<bean name="typePropertyTranslator" class="jeus.tool.webadmin.component.translator.TypePropertyTranslator"/>

    <component id="close_policy_on_leak" type="jeus:Field">
        <binding name="field" value="component:close_policy_on_leakField"/>
    </component>

    <component id="close_policy_on_leakField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:actionOnConnectionLeak"/>
        <binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@getEnumPropertySelectionModel(@jeus.xml.binding.jeusDD.ActionOnResourceLeakType@class, true)"/>
    </component>
    
    <component id="description" type="jeus:Field">
        <binding name="field" value="component:descriptionField"/>
    </component>

    <component id="descriptionField" type="jeus:JAXBTextArea">
        <binding name="parentElement" value="database"/>
        <binding name="elementName" value="literal:description"/>
    </component>
    

    <component id="poolForm" type="jeus:JEUSForm">
        <binding name="title" value="message:dsc.pool.title2"/>
        <binding name="success" value="listener:onPoolOk"/>
    </component>

    <component id="condPool" type="If">
        <binding name="condition" value="!database.dataSourceType.equals(@jeus.xml.binding.jeusDD.DataSourceTypeType@DATA_SOURCE)"/>
        <binding name="renderTag" value="false"/>
    </component>

    <component id="poolingSection" type="jeus:FormSection">
        <binding name="title" value="message:dsc.pool.pooling.title"/>
    </component>

    <component id="min" type="jeus:Field">
        <binding name="field" value="component:minField"/>
    </component>

    <component id="minField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="pooling"/>
        <binding name="elementName" value="literal:min"/>
		<binding name="translator" value="translator:number2"/>
        <binding name="validators" value="validators:min=0"/>
    </component>

    <component id="max" type="jeus:Field">
        <binding name="field" value="component:maxField"/>
    </component>

    <component id="maxField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="pooling"/>
        <binding name="elementName" value="literal:max"/>
        <binding name="validators" value="validators:$maxValidator"/>
    </component>

    <component id="step" type="jeus:Field">
        <binding name="field" value="component:stepField"/>
    </component>

    <component id="stepField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="pooling"/>
        <binding name="elementName" value="literal:step"/>
        <binding name="validators" value="validators:$stepValidator"/>
    </component>

    <component id="period" type="jeus:Field">
        <binding name="field" value="component:periodField"/>
        <binding name="unit" value="message:common.unit.msec"/>
    </component>

    <component id="periodField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="pooling"/>
        <binding name="elementName" value="literal:period"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=1"/>
    </component>

    <component id="wait_free_connectionSection" type="jeus:FormSection">
        <binding name="title" value="message:dsc.pool.wait_free_connection.title"/>
    </component>

    <component id="enable_wait" type="jeus:Field">
        <binding name="field" value="component:enable_waitField"/>
    </component>

    <component id="enable_waitField" type="jeus:JAXBCheckbox">
        <binding name="parentElement" value="waitFreeConnection"/>
        <binding name="elementName" value="literal:enableWait"/>
    </component>

    <component id="pool_blind" type="jeus:Blind">
        <binding name="title" value="message:common.label.advanced"/>
    </component>

    <component id="wait_time" type="jeus:Field">
        <binding name="field" value="component:wait_timeField"/>
        <binding name="unit" value="message:common.unit.msec"/>
    </component>

    <component id="wait_timeField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="waitFreeConnection"/>
        <binding name="elementName" value="literal:waitTime"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=1"/>
    </component>

    <component id="delegation_datasource" type="jeus:Field">
        <binding name="field" value="component:delegation_datasourceField"/>
    </component>

    <component id="delegation_datasourceField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:delegationDatasource"/>
        <binding name="model" value="delegationDatasourceModel"/>
    </component>
    
    <component id="keepConnectionHandleOpen" type="jeus:Field">
        <binding name="field" value="component:keepConnectionHandleOpenField"/>
    </component>

    <component id="keepConnectionHandleOpenField" type="jeus:JAXBCheckbox">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:keepConnectionHandleOpen"/>
    </component>
    
    <component id="initSql" type="jeus:Field">
        <binding name="field" value="component:initSqlField"/>
    </component>

    <component id="initSqlField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:initSql"/>
    </component>    

    <component id="max_use_count" type="jeus:Field">
        <binding name="field" value="component:max_use_countField"/>
    </component>

    <component id="max_use_countField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:maxUseCount"/>
        <binding name="translator" value="translator:number2"/>
        <binding name="validators" value="validators:min=0"/>
    </component>

    <component id="delegation_dba" type="jeus:Field">
        <binding name="field" value="component:delegation_dbaField"/>
    </component>

    <component id="delegation_dbaField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:delegationDba"/>
        <binding name="model" value="delegationDbaModel"/>
    </component>

    <component id="dba_timeout" type="jeus:Field">
        <binding name="field" value="component:dba_timeoutField"/>
        <binding name="unit" value="message:common.unit.msec"/>
    </component>

    <component id="dba_timeoutField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:dbaTimeout"/>
        <binding name="translator" value="translator:number2"/>
        <binding name="validators" value="validators:min=-1"/>
    </component>

    <component id="check_query" type="jeus:Field">
        <binding name="field" value="component:check_queryField"/>
    </component>

    <component id="check_queryField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:checkQuery"/>
    </component>
    
    <component id="check_query_timeout" type="jeus:Field">
        <binding name="field" value="component:check_query_timeoutField"/>
        <binding name="unit" value="message:common.unit.msec"/>
    </component>

    <component id="check_query_timeoutField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:checkQueryTimeout"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>        
    </component>  
    
    <component id="non_validation_interval" type="jeus:Field">
        <binding name="field" value="component:non_validation_intervalField"/>
    </component>

    <component id="non_validation_intervalField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:nonValidationInterval"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>        
    </component>    

    <component id="check_query_period" type="jeus:Field">
        <binding name="field" value="component:check_query_periodField"/>
    </component>

    <component id="check_query_periodField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:checkQueryPeriod"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>
    </component>
    
    <component id="check_query_retrial_count" type="jeus:Field">
        <binding name="field" value="component:check_query_retrial_countField"/>
    </component>

    <component id="check_query_retrial_countField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:checkQueryRetrialCount"/>
        <binding name="translator" value="translator:number2,valueType=Long"/>
        <binding name="validators" value="validators:min=0"/>
    </component>


    <component id="check_query_class" type="jeus:Field">
        <binding name="field" value="component:check_query_classField"/>
    </component>

    <component id="check_query_classField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:checkQueryClass"/>
    </component>
    
    <component id="destroy_policy_on_check_query" type="jeus:Field">
        <binding name="field" value="component:destroy_policy_on_check_queryField"/>
    </component>

    <component id="destroy_policy_on_check_queryField" type="jeus:JAXBPropertySelection">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:destroyPolicyOnCheckQuery"/>
        <binding name="model" value="@jeus.tool.webadmin.page.EnumerationSet@getEnumPropertySelectionModel(@jeus.xml.binding.jeusDD.DestroyPolicyOnCheckQueryType@class)"/>
    </component>
    
    <component id="stmt_caching_size" type="jeus:Field">
        <binding name="field" value="component:stmt_caching_sizeField"/>
    </component>

    <component id="stmt_caching_sizeField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:stmtCachingSize"/>
        <binding name="translator" value="translator:number2"/>
        <binding name="validators" value="validators:min=-1"/>
    </component>

    <component id="stmt_fetch_size" type="jeus:Field">
        <binding name="field" value="component:stmt_fetch_sizeField"/>
    </component>

    <component id="stmt_fetch_sizeField" type="jeus:JAXBTextField">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:stmtFetchSize"/>
        <binding name="translator" value="translator:number2"/>
        <binding name="validators" value="validators:min=-1"/>
    </component>
    
    <component id="useSqlTrace" type="jeus:Field">
        <binding name="field" value="component:useSqlTraceField"/>
    </component>

    <component id="useSqlTraceField" type="jeus:JAXBCheckbox">
        <binding name="parentElement" value="connectionPool"/>
        <binding name="elementName" value="literal:useSqlTrace"/>
    </component>
    
    <component id="connection_trace_enabled" type="jeus:Field">
        <binding name="field" value="component:connection_trace_enabledField"/>
    </component>

    <component id="connection_trace_enabledField" type="jeus:JAXBCheckbox">
        <binding name="parentElement" value="connectionTrace"/>
        <binding name="elementName" value="literal:enabled"/>
    </component>

    <component id="condFound" type="If">
       <binding name="condition" value="database != null"/>
       <binding name="renderTag" value="false"/>
    </component>

    <component id="condNotFound" type="If">
       <binding name="condition" value="database == null or alreadyRemoved"/>
       <binding name="renderTag" value="false"/>
    </component>

    <component id="tabPanel2" type="jeus:TabPanel">
        <binding name="pageNames" value="new java.lang.String[]{pageName}"/>
    </component>

    <component id="dsForm" type="jeus:JEUSForm">
        <binding name="title" value="message:jdss.overview.title"/>
        <binding name="useDefaultButtons" value="false"/>
    </component>

    <component id="no_datasource" type="Insert">
        <binding name="value" value="message:dsc.no.label"/>
    </component>


    <bean name="maxValidator" class="jeus.tool.webadmin.validator.FieldMinMaxValidator">
        <set name="minField" value="component:minField"/>
        <set name="min" value="1"/>
    </bean>

    <bean name="stepValidator" class="jeus.tool.webadmin.validator.StepValidator">
        <set name="minField" value="component:minField"/>
        <set name="maxField" value="component:maxField"/>
        <set name="min" value="0"/>
    </bean>   
    
    <bean name="dataSourceIdValidator" class="jeus.tool.webadmin.page.JeusServiceJDBCDataSourceService.DataSourceIdValidator">
        <set name="jeusSystem" value="jeusSystem"/>
    </bean>

    <bean name="exportNameValidator" class="jeus.tool.webadmin.page.JeusServiceJDBCDataSourceService.ExportNameValidator">
        <set name="jeusSystem" value="jeusSystem"/>
        <set name="dataSourceId" value="component:data_source_idField"/>
    </bean>
    
    <bean name="dataSourceTargetValidator" class="jeus.tool.webadmin.page.JeusServiceJDBCDataSourceService.DataSourceTargetValidator">
        <set name="jeusSystem" value="jeusSystem"/>
        <set name="dataSourceIdValue" value="database.dataSourceId"/>
        <set name="exportNameValue" value="database.exportName"/>
    </bean>
    <bean name="listTranslator" class="jeus.tool.webadmin.component.translator.ListTranslator"/>  
     
</page-specification>
