/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["jeus.Stacktrace"]){dojo._hasResource["jeus.Stacktrace"]=true;dojo.provide("jeus.Stacktrace");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dojo.i18n");dojo.requireLocalization("jeus","common",null,"ROOT,ko");dojo.declare("jeus.Stacktrace",[dijit._Widget,dijit._Templated],{templateString:"<div><dl class=\"jeusStacktraceOption\"><dt>${patternLabel}</dt><dd>${pattern}</dd><dt>${refreshLabel}</dt><dd><input type=\"text\" value=\"${interval}\" size=\"10\" dojoAttachEvent=\"onkeydown:_checkNumber, onchange:_onChangeInterval\"/></dd><dt>${bufferLabel}</dt><dd><input type=\"text\" value=\"${buffer}\" size=\"10\" dojoAttachEvent=\"onkeydown:_checkNumber, onchange:_onChangeBuffer\"/></dd></dl><div dojoAttachPoint=\"traceNode\" class=\"jeusStacktrace\"></div></div>",interval:10,buffer:100,url:"",objectName:"",fileName:"",pattern:"",startPosition:0,postMixInProperties:function(){var _1=dojo.i18n.getLocalization("jeus","common");this.patternLabel=_1.filePattern;this.refreshLabel=_1.refresh;this.bufferLabel=_1.bufferSize;},postCreate:function(){this.nodeList=new dojo.NodeList(this.traceNode);},startup:function(){this._refresh();this.timer=setInterval(dojo.hitch(this,"_refresh"),this.interval*1000);this.inherited(arguments);},_checkNumber:function(e){var _2=e.keyCode;if((_2>=48&&_2<=57)||(_2>=96&&_2<=105)||_2==35||_2==36||_2==37||_2==39||_2==46||_2==8){}else{dojo.stopEvent(e);}},_onChangeInterval:function(e){this.interval=e.target.value;clearInterval(this.timer);this.timer=setInterval(dojo.hitch(this,"_refresh"),this.interval*1000);},_onChangeBuffer:function(e){this.buffer=e.target.value;this._updateTrace();},_refresh:function(){dojo.xhrGet({url:this.url,handleAs:"json",content:{objectName:this.objectName,pattern:this.pattern,fileName:this.fileName,startPosition:this.startPosition},load:dojo.hitch(this,"_updateTrace")});},_updateTrace:function(_3,_4){if(!!_3){this.fileName=_3["fileName"];this.startPosition=_3["startPosition"];dojo.forEach(_3["content"],function(_5){this.nodeList.addContent("<div>"+_5+"</div>","first");},this);}var _6=this.nodeList.query("div");if(_6.length>=this.buffer){_6.forEach(function(_7,_8){if(_8>=this.buffer){_7.parentNode.removeChild(_7);}},this);}},uninitialize:function(){clearInterval(this.timer);this.timer=null;return this.inherited(arguments);}});}